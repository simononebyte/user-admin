# user-admin
 A collection of scripts to automate various user administration task

# Top Level Steps

These are the high level steps required for creating a new user. I will break
these down into smaller, more targetted scripts. 

 1. Load config
 2. Depending on host check if run as admin
 3. Confirm user details
    - First & Last NAme
    - Email (if different from auto-generated one)
    - Office
    - Job Title
    - Ext
    - Qualifications
    - Remote desktop server
    - Groups (See note 1)
 4. Pre-flight check to ensure there are no clashes. Fail if found.
    - Does user exist?
    - Do home folders exist?
    - Does email address exist?
 5. Create the domain account
 6. Update the office information (User existing set-office script)
 7. Update display name to append qualifications
 8. Create user folders and set correct permissions
 9. Add to mandatory groups
10. Add to remote desktop group
11. Generate and set the password
12. Run AD Sync to get account registered on Office 365
13. Display account details confirmation. e.g. username and password
14. Display next steps message e.g.
    - Log into Office 365 and assign a license
    - Add to the correct signature group in Office 365
    - Log into Exclaimer and sync details

# Config File

The following settings are available in the configuratiopn file. These allow
the sames scripts to run in different envornments.

## Require Elevated

This settings will cause the script to check for an elevated session. This is
required when running the scripts on a domain controller or other device that
has Azure AD Sync installed. In most other situations elevation is not needed.

| Setting          | Description |
| ---------------- | ----------- |
| require_elevated | If true the script will halt unless it is elevated |

**Example**
`"require_elevated": "true"`

## Username Format

Each company has a preferred format for their user names. This countrols the
preferred format and also the fallback format in the case of a clash.

| Setting           | Description |
| ----------------- | ----------- |
| username_format   | The preffered foramt  |
| username_fallback | The format to use in the case of a clash |

**username_format:** The format is based on how mnuch of the first and/or
last name to use. So `first` indicates the full firstname should be used and
`last` indicates the full last name should be used. These can be combined so
`first.last` would make Simon Buckner become 'simon.buckner'. Some companies 
only want an initial from one of the name which can be handled using `fx` or
`lx` where `x` is the nuumber of characters to use. E.g. `f1last` would create
a username of `sbuckner`.

**username_fallback:** Uses the same formating as `username_format` to define
the username format to use of the one generated by the preferred option is 
already in use by another account.

**Example**

```
"username_format": "f1last",
"username_fallback" : "f2last"
```

## Feature Flags

Different companies use differing levels of information in the environments.
These flags turn various functionality on or off as required. These are all 
boolean flags accepting `true` or `false`.

| Flag           | Description |
| -------------- | ----------- |
| qualifications | Appends professional qualifications to the display name |
| office_address | Add predefined office address details to the account |
| ad_sync        | Should an AD Sync request be submitted |
| exclaimer      | If Exclaimer Signature is used then prompt in next steps |

**Example**

```
"flags" : {
    "qualifications" : "false",
    "office_address" : "true",
    "ad_sync" : "true",
    "exclaimer" : "true"
}
```
## User Folders

When creating a user it may be required to produce one or more folders in
various locations. 

| Setting         | Description |
| --------------- | ----------- |
| display_name    | Displayed by the script when creating the folder |
| path            | PAth to create the folder in |
| protect         | Protect the folder from accidental deletion |
| admin_groups    | A list of groups to grant admin access to this folder |
| profile_version | If this is a profile folder which version to create |

**Paths:**  When a folder is created, the username of the account being created is used.
So if the username is just the first name, e.g. Simon then the folder created
will be `\\server\share\simon`. To keep things neat, the path will be 
converted to lower case.

**profile_version:** Windows has several profiles version for romaing profiles. These are denoted
by append the version number to the filename, for example.

`\\server1\share\simon`

Would become.

`\\server1\share\simon.V5`

Full details of these versions can be found [here](https://support.microsoft.com/en-gb/help/3056198/roaming-user-profiles-versioning-in-windows-10-and-windows-server).


**Example**

```
"user_folders": [
    {
        "display_name": "Home Folder",
        "path": "\\server1\share\",
        "protect": "true",
        "admin_groups": [
            "domain\admin group"
        ],
        "profile_version": ""
    }, 
        "display_name": "Romaing Profile",
        "path": "\\server2\share\",
        "protect": "true",
        "admin_groups": [
            "domain\admin group"
        ],
        "profile_version": "6"
    }
]
```

## Offices

If the company uses peoples office address on their accounts then the 
acceptable values are listed here.

| Setting    | Description |
| ---------- | ----------- |
| short_code | 2 letter code to select the office by |
| name       | The name of the office |
| phone      | The phone number for the office |
| steet      | The address of the office, except city and postcode |
| city       | Thetown or  city |
| postcode   | The postcode |

**Example**
```
"offices": [
    {
        "short_code": "ho",
        "name": "Head OFfice",
        "phone": "+44 (0) 1603 516 156",
        "steet": "17 Palace Street",
        "city": "Norwich",
        "postcode": "NR3 1RT"
    },
    {
        "short_code": "lo",
        "name": "London Office",
        "phone": "+44 (0) 20 3189 2100",
        "steet": "Unit 27, St Markâ€™s Studios, 14 Chillingworth Road",
        "city": "London",
        "postcode": "N7 8QL"
    }
]
```